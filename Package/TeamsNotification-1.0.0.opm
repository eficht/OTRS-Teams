<?xml version="1.0" encoding="utf-8" ?>
<otrs_package version="1.1">
    <Name>TeamsNotification</Name>
    <Version>1.0.0</Version>
    <Vendor>meisterheister</Vendor>
    <URL>https://github.com/meisterheister/</URL>
    <License>GNU AFFERO GENERAL PUBLIC LICENSE Version 3, November 2007</License>
	<ChangeLog Version="1.0.0" Date="2019-12-11 14:00:00">Initial release.</ChangeLog>
	<Description Lang="en">
Provides an event based module to send a notification to a Microsoft Teams webhook. A webhook per Teams channel is needed. The webhook URL is choosen based on the queue it was associated with. This association is done in System Config item TeamsNotification::QueueToWebhookURL.

Follow the below link on how to create a webhook:
https://docs.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook
    </Description>
    <Framework>6.0.x</Framework>
    <IntroInstall Lang="en" Title="Thank you!" Type="post">Thank you for installing the TeamsNotification module.</IntroInstall>
    <PackageIsVisible>1</PackageIsVisible>
    <PackageIsDownloadable>1</PackageIsDownloadable>
    <PackageIsRemovable>1</PackageIsRemovable>
    <BuildDate>2019-12-11 14:00:00</BuildDate>
    <BuildHost>otrs-6</BuildHost>
    <Filelist>
        <File Location="Kernel/Config/Files/XML/TeamsNotification.xml" Permission="644" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiID8+CjxvdHJzX2NvbmZpZyB2ZXJzaW9uPSIyLjAiIGluaXQ9IkFwcGxpY2F0aW9uIj4KICAgICAgPFNldHRpbmcgTmFtZT0iVGVhbXNOb3RpZmljYXRpb246OlF1ZXVlVG9XZWJob29rVVJMIiBSZXF1aXJlZD0iMCIgVmFsaWQ9IjEiPgogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPlRlYW1zIFdlYmhvb2sgVVJMczwvRGVzY3JpcHRpb24+CiAgICAgICAgPE5hdmlnYXRpb24+VGVhbXM6OkFQSTwvTmF2aWdhdGlvbj4KICAgICAgICA8VmFsdWU+CiAgICAgICAgICAgIDxIYXNoPgogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJRdWV1ZSI+UmF3PC9JdGVtPgogICAgICAgICAgICA8L0hhc2g+CiAgICAgICAgPC9WYWx1ZT4KICAgIDwvU2V0dGluZz4KICA8U2V0dGluZyBOYW1lPSJUaWNrZXQ6OkV2ZW50TW9kdWxlUG9zdCMjIzExMS1UZWFtc05vdGlmaWNhdGlvbiIgUmVxdWlyZWQ9IjAiIFZhbGlkPSIxIj4KICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+U2VuZHMgbm90aWZpY2F0aW9uIHRvIE1pY3Jvc29mdCBUZWFtcy48L0Rlc2NyaXB0aW9uPgogICAgICA8TmF2aWdhdGlvbj5Db3JlOjpUaWNrZXQ8L05hdmlnYXRpb24+CiAgICAgIDxWYWx1ZT4KICAgICAgICAgIDxIYXNoPgogICAgICAgICAgICAgIDxJdGVtIEtleT0iTW9kdWxlIj5LZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpFdmVudDo6VGVhbXNOb3RpZmljYXRpb248L0l0ZW0+CiAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJFdmVudCI+KEFydGljbGVDcmVhdGUpPC9JdGVtPgogICAgICAgICAgPC9IYXNoPgogICAgICA8L1ZhbHVlPgogIDwvU2V0dGluZz4KPC9vdHJzX2NvbmZpZz4=</File>
        <File Location="Kernel/System/Ticket/Event/TeamsNotification.pm" Permission="644" Encode="Base64">IyAtLQojIChUZWFtc05vdGlmaWNhdGlvbi5wbSkgLSBzZW5kcyBhIEpTT04gcGF5bG9hZCB0byBhIE1pY3Jvc29mdCBUZWFtcyB3ZWJob29rCiMgQ29weXJpZ2h0IChDKSAyMDAxLTIwMTkgT1RSUyBBRywgaHR0cHM6Ly9vdHJzLmNvbS8KIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6RXZlbnQ6OlRlYW1zTm90aWZpY2F0aW9uOwoKdXNlIHN0cmljdDsKdXNlIHV0Zjg7CnVzZSBFbmNvZGU7CnVzZSB3YXJuaW5nczsKCiRFTlZ7UEVSTF9MV1BfU1NMX1ZFUklGWV9IT1NUTkFNRX09MDsKCnVzZSBMV1A6OlVzZXJBZ2VudDsKdXNlIEhUVFA6OlJlcXVlc3Q6OkNvbW1vbjsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gcXcoCiAgICBLZXJuZWw6OkNvbmZpZwogICAgS2VybmVsOjpTeXN0ZW06OkxvZwogICAgS2VybmVsOjpTeXN0ZW06OlRpY2tldAogICAgS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZQogICAgS2VybmVsOjpTeXN0ZW06OlVzZXIKKTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CiAgICBteSAkTG9nT2JqZWN0ICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKTsKICAgIG15ICRUaWNrZXRPYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwogICAgbXkgJEFydGljbGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyk7CiAgICBteSAkVXNlck9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgIE1lc3NhZ2UgID0+ICdSdW4gVGVhbXNOb3RpZmljYXRpb24gZXZlbnQgbW9kdWxlJywKICAgICk7CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkUGFyYW0gKHF3KEV2ZW50IERhdGEgQ29uZmlnIFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZFBhcmFtfSApIHsKICAgICAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWRQYXJhbSEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIGZvciBteSAkTmVlZGVkRGF0YSAocXcoVGlja2V0SUQgQXJ0aWNsZUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXtEYXRhfS0+eyROZWVkZWREYXRhfSApIHsKICAgICAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWREYXRhIGluIERhdGEhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB0aWNrZXQgYXR0cmlidXRlIG1hdGNoZXMKICAgIG15ICVBcnRpY2xlID0gJEFydGljbGVPYmplY3QtPkFydGljbGVHZXQoCiAgICAgICAgQXJ0aWNsZUlEICAgID0+ICRQYXJhbXtEYXRhfS0+e0FydGljbGVJRH0sCiAgICAgICAgVGlja2V0SUQgICAgID0+ICRQYXJhbXtEYXRhfS0+e1RpY2tldElEfSwKICAgICAgICBTdWJqZWN0ICAgICAgPT4gJFBhcmFte0RhdGF9LT57U3ViamVjdH0sCiAgICAgICAgRnJvbSAgICAgICAgID0+ICRQYXJhbXtEYXRhfS0+e0Zyb219LAogICAgICAgIFNlbmRlclR5cGUgICA9PiAkUGFyYW17RGF0YX0tPntTZW5kZXJUeXBlfSwKICAgICk7CiAgICBteSAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgIFRpY2tldElEICAgICA9PiAkUGFyYW17RGF0YX0tPntUaWNrZXRJRH0sCiAgICAgICAgVGl0bGUgICAgICAgID0+ICRQYXJhbXtEYXRhfS0+e1RpdGxlfSwKICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFBhcmFte0RhdGF9LT57VGlja2V0TnVtYmVyfSwKICAgICAgICBRdWV1ZSAgICAgICAgPT4gJFBhcmFte0RhdGF9LT57UXVldWV9LCAgICAgICAgCiAgICAgICAgU3RhdGUgICAgICAgID0+ICRQYXJhbXtEYXRhfS0+e1N0YXRlfSwKICAgICAgICBPd25lcklEICAgICAgPT4gJFBhcmFte0RhdGF9LT57T3duZXJJRH0sCiAgICAgICAgUHJpb3JpdHkgICAgID0+ICRQYXJhbXtEYXRhfS0+e1ByaW9yaXR5fSwKICAgICk7CgogICAgIyBzeXN0ZW0gY29uZmlnIHZhcnMKICAgIG15ICRUaWNrZXRIb29rICA9ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpIb29rJyk7CiAgICAgICAkVGlja2V0SG9vayAuPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6SG9va0RpdmlkZXInKTsKICAgIG15ICRTeXN0ZW1GUUROICA9ICRDb25maWdPYmplY3QtPkdldCgnRlFETicpOwogICAgbXkgJFN5c3RlbUhUVFAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdIdHRwVHlwZScpOwogICAgbXkgJFN5c3RlbUFsaWFzID0gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpOwoKICAgICMgZ2V0IGFnZW50IG5hbWUKICAgICRUaWNrZXR7VXNlck5hbWV9ID0gJFVzZXJPYmplY3QtPlVzZXJOYW1lKCBVc2VySUQgPT4gJFRpY2tldHtPd25lcklEfSApOwogCiAgICAjIGVzY2FwZSBkb3VibGUgcXVvdGVzIAogICAgKG15ICRGcm9tX25vcXVvdGVzID0gJEFydGljbGV7RnJvbX0pID1+IHMvXCIvXFwiL2c7CgogICAgIyBkZWZpbmUgdmFycwogICAgbXkgJFdlYmhvb2tVUkw7CiAgICBteSAkTWVzc2FnZVRpdGxlOwoKICAgICMgcnVuIG9ubHkgZm9yIEFydGljbGVzIHdpdGggU2VuZGVyVHlwZSAnY3VzdG9tZXInCiAgICBpZiAoICRBcnRpY2xle1NlbmRlclR5cGV9IG5lICdjdXN0b21lcicgKQogICAgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnbm90aWNlJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkV4Y2x1ZGVkIHJ1bm5pbmcgV2ViaG9vayBmb3IgU2VuZGVyVHlwZSAkQXJ0aWNsZXtTZW5kZXJUeXBlfSIKICAgICAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCAkVGlja2V0e1N0YXRlfSBlcSAnbmV3JyApCiAgICB7IAogICAgICAgICRNZXNzYWdlVGl0bGUgPSAiTmV3IFRpY2tldDogJFRpY2tldHtUaXRsZX0iOyAKICAgICAgICB9IAogICAgZWxzZSB7IAogICAgICAgICRNZXNzYWdlVGl0bGUgPSAiTmV3IG1lc3NhZ2U6ICRBcnRpY2xle1N1YmplY3R9IjsKICAgICAgICB9CgogICAgIyBlbmNvZGUgdXRmLTgKICAgICRNZXNzYWdlVGl0bGUgPSBFbmNvZGU6OmVuY29kZSgidXRmOCIsICRNZXNzYWdlVGl0bGUpOwogICAgbXkgJE93bmVyID0gRW5jb2RlOjplbmNvZGUoInV0ZjgiLCAkVGlja2V0e1VzZXJOYW1lfSk7CgogICAgIyBnZXQgV2ViSG9va1VSTCBmb3IgUXVldWUKICAgIG15ICVXZWJob29rVVJMcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCggJ1RlYW1zTm90aWZpY2F0aW9uOjpRdWV1ZVRvV2ViaG9va1VSTCcgKSB9OwoJZm9yIG15ICRXZWJIb29rUXVldWUgKCBzb3J0IGtleXMgJVdlYmhvb2tVUkxzICkgICAKCXsKCQlpZiAoICRUaWNrZXR7UXVldWV9IGVxICRXZWJIb29rUXVldWUgKSB7CgkJICAgICRXZWJob29rVVJMID0gJFdlYmhvb2tVUkxzeyRXZWJIb29rUXVldWV9OwoJCSAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnbm90aWNlJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiUnVuIFdlYkhvb2sgZm9yIFF1ZXVlICRXZWJIb29rUXVldWUiCiAgICAgICAgICAgICAgICApOwogIAkgICB9Cgl9CgogICAgIyBlcnJvciBvbiBlbXB0eSBXZWJob29rIFVSTAogICAgaWYgKCAhJFdlYmhvb2tVUkwgKQogICAgewogICAgCSRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gV2ViaG9va1VSTCBkZWZpbmVkIGZvciBRdWV1ZSAkVGlja2V0e1F1ZXVlfSIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAkdWEgPSBMV1A6OlVzZXJBZ2VudC0+bmV3OwogICAgbXkgJHJlcSA9IEhUVFA6OlJlcXVlc3QtPm5ldyhQT1NUID0+ICRXZWJob29rVVJMKTsKICAgICRyZXEtPmhlYWRlcignY29udGVudC10eXBlJyA9PiAnYXBwbGljYXRpb24vanNvbicpOwoKICAgICMgYWRkIFBPU1QgZGF0YSB0byBIVFRQIHJlcXVlc3QgYm9keQogICAgbXkgJHBvc3RfZGF0YSA9ICJ7CgkJXCJcQGNvbnRleHRcIjogXCJodHRwczovL3NjaGVtYS5vcmcvZXh0ZW5zaW9uc1wiLAoJCVwiXEB0eXBlXCI6IFwiTWVzc2FnZUNhcmRcIiwKCQlcInRoZW1lQ29sb3JcIjogXCIwMDc2RDdcIiwKICAgICAgICBcInN1bW1hcnlcIjogXCJOZXcgVGlja2V0IFVwZGF0ZVwiLAogICAgICAgIFwidGl0bGVcIjogXCIkTWVzc2FnZVRpdGxlXCIsCgkJXCJzZWN0aW9uc1wiOiBbewoJCQlcImFjdGl2aXR5VGl0bGVcIjogXCJGcm9tOiAkRnJvbV9ub3F1b3Rlc1wiLAoJCQlcImFjdGl2aXR5U3VidGl0bGVcIjogXCJpbiBRdWV1ZSAkVGlja2V0e1F1ZXVlfVwiLAoJCQlcImFjdGl2aXR5SW1hZ2VcIjogXCIkU3lzdGVtSFRUUDovLyRTeXN0ZW1GUUROL290cnMtd2ViL3NraW5zL0FnZW50L2RlZmF1bHQvaW1nL25vbmVcIiwJCiAgICAgICAgICAgICAgICBcImZhY3RzXCI6IFt7IAoJCQkJCVwibmFtZVwiOiBcIlRpY2tldCBOdW1iZXJcIiwgCgkJCQkJXCJ2YWx1ZVwiOiBcIiRUaWNrZXRIb29rJFRpY2tldHtUaWNrZXROdW1iZXJ9XCIgCgkJCQl9LCB7IAoJCQkJCVwibmFtZVwiOiBcIkFzc2lnbmVkIHRvXCIsIAoJCQkJCVwidmFsdWVcIjogXCIkT3duZXJcIiAKCQkJCX0sIHsgCgkJCQkJXCJuYW1lXCI6IFwiU3RhdHVzXCIsIAoJCQkJCVwidmFsdWVcIjogXCIkVGlja2V0e1N0YXRlfVwiIAoJCQkJfSx7IAoJCQkJCVwibmFtZVwiOiBcIlByaW9yaXR5XCIsIAoJCQkJCVwidmFsdWVcIjogXCIkVGlja2V0e1ByaW9yaXR5fVwiIAoJCQkJfV0sCiAgICAgICAgICAgICAgICBcIm1hcmtkb3duXCI6IHRydWUKICAgICAgICB9XSwKICAgICAgICBcInBvdGVudGlhbEFjdGlvblwiOiBbeyAgICAgICAgCgkJCQkJXCJcQHR5cGVcIjogXCJPcGVuVXJpXCIsIAoJCQkJCVwibmFtZVwiOiBcIlZpZXcgaW4gSGVscGRlc2tcIiwKICAgICAgICAgICAgICAgICAgICAgICAgXCJ0YXJnZXRzXCI6IFt7IAoJCQkJCSAgICAgICAgXCJvc1wiOiBcImRlZmF1bHRcIiwgCgkJCQkJICAgICAgICBcInVyaVwiOiBcIiRTeXN0ZW1IVFRQOi8vJFN5c3RlbUZRRE4vJFN5c3RlbUFsaWFzL2luZGV4LnBsP0FjdGlvbj1BZ2VudFRpY2tldFpvb207VGlja2V0SUQ9JFRpY2tldHtUaWNrZXRJRH0jJEFydGljbGV7QXJ0aWNsZUlEfVwiIAoJCQkJCSAgICAgICAgfQogICAgICAgICAgICAgICAgXQoJCQl9CgkJXQoJfSI7CgogICAgIyBQT1NUCiAgICAkcmVxLT5jb250ZW50KCRwb3N0X2RhdGEpOwoKICAgIG15ICRyZXNwID0gJHVhLT5yZXF1ZXN0KCRyZXEpOwogICAgaWYgKCRyZXNwLT5pc19zdWNjZXNzKSB7CiAgICAgIG15ICRtZXNzYWdlID0gJHJlc3AtPmRlY29kZWRfY29udGVudDsKICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgICBNZXNzYWdlICA9PiAiUnVuIFRlYW1zTm90aWZpY2F0aW9uIGV2ZW50IG1vZHVsZSxSZWNlaXZlZCByZXBseTogJG1lc3NhZ2UiICwKICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAkTG9nT2JqZWN0LT5Mb2coCiAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgTWVzc2FnZSAgPT4gIlJIVFRQIFBPU1QgZXJyb3IgY29kZTogJHJlc3AtPmNvZGUiICwKICAgICAgKTsKICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgIE1lc3NhZ2UgID0+ICJSSFRUUCBQT1NUIGVycm9yIG1lc3NhZ2U6ICRyZXNwLT5tZXNzYWdlIiAsCiAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCjE7</File>
    </Filelist>
</otrs_package>